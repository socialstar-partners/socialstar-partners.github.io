<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Photo Rating Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: #10183C;
            color: white;
            height: 100vh;
            overflow: hidden;
            position: relative;
        }

        /* Main Photo Container */
        .photo-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #10183C;
        }

        .photo-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .photo-overlay-text {
            position: absolute;
            color: white;
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            width: 80%;
            left: 50%;
            transform: translateX(-50%);
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }

        /* Navigation Bar */
        .navigation-bar {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.5), transparent);
            z-index: 10;
        }

        .nav-button {
            width: 40px;
            height: 40px;
            background: none;
            border: none;
            color: white;
            font-size: 30px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            filter: drop-shadow(0 2px 5px rgba(0,0,0,0.5));
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 250px;
        }

        .profile-picture {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: #DAA520;
            object-fit: cover;
        }

        .username {
            font-size: 20px;
            font-weight: bold;
            filter: drop-shadow(0 2px 5px rgba(0,0,0,0.5));
        }

        .theme-badge {
            background: rgba(255,255,255,0.2);
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }

        /* Bottom Sheet */
        .bottom-sheet {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: #1A2245;
            border-radius: 20px 20px 0 0;
            z-index: 20;
            transition: none;
            will-change: transform;
        }

        .sheet-handle {
            padding: 15px;
            cursor: grab;
        }

        .sheet-handle:active {
            cursor: grabbing;
        }

        .handle-bar {
            width: 40px;
            height: 5px;
            background: rgba(255,255,255,0.3);
            border-radius: 100px;
            margin: 0 auto;
        }

        .sheet-content {
            padding: 0 20px 20px;
            max-height: calc(100vh - 200px);
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .ratings-header {
            font-size: 16px;
            font-weight: bold;
            color: rgba(255,255,255,0.7);
            margin-bottom: 15px;
        }

        /* Rating Items */
        .rating-item {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .rating-item:last-child {
            border-bottom: none;
        }

        .rating-user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        .rating-profile-pic {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #4A5568;
            object-fit: cover;
        }

        .rating-username {
            font-size: 16px;
            font-weight: bold;
        }

        .rating-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            background: #DAA520;
            padding: 5px 10px;
            border-radius: 20px;
        }

        .rating-badge .star {
            width: 16px;
            height: 16px;
        }

        /* Star Rating Footer */
        .star-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #10183C;
            padding: 25px 0;
            display: flex;
            justify-content: center;
            gap: 12px;
            z-index: 30;
            height: 100px;
        }

        .star-footer.voted {
            background: #A9A9A9;
        }

        .star-button {
            background: none;
            border: none;
            font-size: 34px;
            color: white;
            cursor: pointer;
            padding: 5px;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .star-button.filled {
            color: #FFD700;
        }

        .star-button.voted {
            color: #c2c2c2;
            cursor: not-allowed;
        }

        .star-button.animate {
            transform: scale(1.3);
        }

        /* Download Prompt */
        .download-prompt {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #1A2245;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            max-width: 90%;
            width: 350px;
            z-index: 100;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }

        .download-prompt h2 {
            font-size: 24px;
            margin-bottom: 15px;
        }

        .download-prompt p {
            color: rgba(255,255,255,0.7);
            margin-bottom: 25px;
            line-height: 1.5;
        }

        .download-button {
            background: #DAA520;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 30px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-bottom: 10px;
        }

        .dismiss-button {
            background: none;
            color: rgba(255,255,255,0.5);
            border: none;
            padding: 10px;
            font-size: 14px;
            cursor: pointer;
        }

        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            z-index: 99;
        }

        /* Responsive adjustments */
        @media (max-height: 700px) {
            .star-footer {
                padding: 20px 0;
                height: 80px;
            }
            .star-button {
                font-size: 28px;
            }
        }
    </style>
</head>
<body>
    <!-- Main Photo -->
    <div class="photo-container">
        <img class="photo-image" src="https://images.unsplash.com/photo-1682687220742-aba13b6e50ba?w=800&h=1200&fit=crop" alt="Mountain landscape">
        <div class="photo-overlay-text" style="top: 30%;">Epic mountain views! üèîÔ∏è</div>
    </div>

    <!-- Navigation Bar -->
    <nav class="navigation-bar">
        <button class="nav-button" onclick="goBack()">‚Üê</button>
        <div class="user-info">
            <img class="profile-picture" src="https://i.pravatar.cc/150?img=8" alt="Profile">
            <span class="username">Alex Chen</span>
            <span class="theme-badge">Nature</span>
        </div>
        <button class="nav-button">üí¨</button>
    </nav>

    <!-- Bottom Sheet -->
    <div class="bottom-sheet" id="bottomSheet">
        <div class="sheet-handle" id="sheetHandle">
            <div class="handle-bar"></div>
        </div>
        <div class="sheet-content">
            <div class="ratings-header">Ratings (<span id="ratingCount">4</span>)</div>
            <div id="ratingsList">
                <!-- Initial ratings -->
                <div class="rating-item">
                    <div class="rating-user-info">
                        <img class="rating-profile-pic" src="https://i.pravatar.cc/150?img=1" alt="Sarah">
                        <span class="rating-username">Sarah Johnson</span>
                    </div>
                    <div class="rating-badge">
                        <span>5</span>
                        <svg class="star" viewBox="0 0 24 24" fill="white">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                    </div>
                </div>
                <div class="rating-item">
                    <div class="rating-user-info">
                        <img class="rating-profile-pic" src="https://i.pravatar.cc/150?img=3" alt="Mike">
                        <span class="rating-username">Mike Thompson</span>
                    </div>
                    <div class="rating-badge">
                        <span>4</span>
                        <svg class="star" viewBox="0 0 24 24" fill="white">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                    </div>
                </div>
                <div class="rating-item">
                    <div class="rating-user-info">
                        <img class="rating-profile-pic" src="https://i.pravatar.cc/150?img=5" alt="Emma">
                        <span class="rating-username">Emma Wilson</span>
                    </div>
                    <div class="rating-badge">
                        <span>5</span>
                        <svg class="star" viewBox="0 0 24 24" fill="white">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                    </div>
                </div>
                <div class="rating-item">
                    <div class="rating-user-info">
                        <img class="rating-profile-pic" src="https://i.pravatar.cc/150?img=7" alt="David">
                        <span class="rating-username">David Lee</span>
                    </div>
                    <div class="rating-badge">
                        <span>3</span>
                        <svg class="star" viewBox="0 0 24 24" fill="white">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Star Rating Footer -->
    <div class="star-footer" id="starFooter">
        <button class="star-button" data-rating="1">‚òÖ</button>
        <button class="star-button" data-rating="2">‚òÖ</button>
        <button class="star-button" data-rating="3">‚òÖ</button>
        <button class="star-button" data-rating="4">‚òÖ</button>
        <button class="star-button" data-rating="5">‚òÖ</button>
    </div>

    <!-- Download Prompt -->
    <div class="overlay" id="overlay"></div>
    <div class="download-prompt" id="downloadPrompt">
        <h2>üéâ Nice Rating!</h2>
        <p>Love this experience? Download our app to rate photos with your friends and compete in daily challenges!</p>
        <button class="download-button" onclick="downloadApp()">Download App</button>
        <button class="dismiss-button" onclick="dismissPrompt()">Maybe Later</button>
    </div>

    <script>
        // State management
        let currentRating = 0;
        let hasVoted = false;
        let isDragging = false;
        let startY = 0;
        let currentY = 0;
        let sheetY = 0;
        
        // Sheet positions
        const minHeight = 80;
        const midHeight = window.innerHeight * 0.25;
        const maxHeight = window.innerHeight - 180;
        let currentDetent = 'mid';
        
        // Elements
        const bottomSheet = document.getElementById('bottomSheet');
        const sheetHandle = document.getElementById('sheetHandle');
        const starFooter = document.getElementById('starFooter');
        const starButtons = document.querySelectorAll('.star-button');
        const ratingsList = document.getElementById('ratingsList');
        const ratingCount = document.getElementById('ratingCount');
        const downloadPrompt = document.getElementById('downloadPrompt');
        const overlay = document.getElementById('overlay');
        
        // Initialize sheet position
        function setSheetPosition(height) {
            bottomSheet.style.transform = `translateY(${window.innerHeight - height - 100}px)`;
            sheetY = window.innerHeight - height - 100;
        }
        
        // Set initial position
        setSheetPosition(midHeight);
        
        // Touch/Mouse event handlers for bottom sheet
        function handleStart(e) {
            isDragging = true;
            startY = e.type.includes('mouse') ? e.clientY : e.touches[0].clientY;
            bottomSheet.style.transition = 'none';
        }
        
        function handleMove(e) {
            if (!isDragging) return;
            
            e.preventDefault();
            currentY = e.type.includes('mouse') ? e.clientY : e.touches[0].clientY;
            const deltaY = currentY - startY;
            
            let newY = sheetY + deltaY;
            const currentHeight = window.innerHeight - newY - 100;
            
            // Constrain movement
            if (currentHeight < minHeight) {
                newY = window.innerHeight - minHeight - 100;
            } else if (currentHeight > maxHeight) {
                newY = window.innerHeight - maxHeight - 100;
            }
            
            bottomSheet.style.transform = `translateY(${newY}px)`;
        }
        
        function handleEnd(e) {
            if (!isDragging) return;
            
            isDragging = false;
            bottomSheet.style.transition = 'transform 0.35s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
            
            const endY = e.type.includes('mouse') ? e.clientY : e.changedTouches[0].clientY;
            const deltaY = endY - startY;
            const velocity = deltaY;
            
            const currentHeight = window.innerHeight - sheetY - 100;
            
            // Determine new position based on gesture
            let targetHeight;
            
            if (currentDetent === 'min') {
                if (deltaY < -50 || velocity < -100) {
                    targetHeight = midHeight;
                    currentDetent = 'mid';
                } else {
                    targetHeight = minHeight;
                }
            } else if (currentDetent === 'mid') {
                if (deltaY < -50 || velocity < -100) {
                    targetHeight = maxHeight;
                    currentDetent = 'max';
                } else if (deltaY > 50 || velocity > 100) {
                    targetHeight = minHeight;
                    currentDetent = 'min';
                } else {
                    targetHeight = midHeight;
                }
            } else {
                if (deltaY > 50 || velocity > 100) {
                    targetHeight = midHeight;
                    currentDetent = 'mid';
                } else {
                    targetHeight = maxHeight;
                }
            }
            
            setSheetPosition(targetHeight);
        }
        
        // Add event listeners for dragging
        sheetHandle.addEventListener('mousedown', handleStart);
        sheetHandle.addEventListener('touchstart', handleStart, { passive: false });
        
        document.addEventListener('mousemove', handleMove);
        document.addEventListener('touchmove', handleMove, { passive: false });
        
        document.addEventListener('mouseup', handleEnd);
        document.addEventListener('touchend', handleEnd);
        
        // Star rating functionality
        starButtons.forEach((button, index) => {
            button.addEventListener('click', function() {
                if (hasVoted) return;
                
                const rating = parseInt(button.dataset.rating);
                currentRating = rating;
                
                // Update star colors
                starButtons.forEach((btn, i) => {
                    if (i < rating) {
                        btn.classList.add('filled');
                        btn.classList.add('animate');
                        setTimeout(() => btn.classList.remove('animate'), 300);
                    } else {
                        btn.classList.remove('filled');
                    }
                });
                
                // Haptic feedback simulation (vibration if supported)
                if (navigator.vibrate) {
                    navigator.vibrate([50, 100, 50]);
                }
                
                // Submit rating after animation
                setTimeout(() => {
                    submitRating(rating);
                }, 500);
            });
        });
        
        function submitRating(rating) {
            hasVoted = true;
            
            // Update UI to show voted state
            starFooter.classList.add('voted');
            starButtons.forEach(btn => btn.classList.add('voted'));
            
            // Add new rating to list with animation
            const newRating = createRatingItem('You', rating, 'https://i.pravatar.cc/150?img=12');
            newRating.style.opacity = '0';
            newRating.style.transform = 'translateY(20px)';
            ratingsList.insertBefore(newRating, ratingsList.firstChild);
            
            // Animate in
            setTimeout(() => {
                newRating.style.transition = 'all 0.3s ease';
                newRating.style.opacity = '1';
                newRating.style.transform = 'translateY(0)';
            }, 10);
            
            // Update count
            const currentCount = parseInt(ratingCount.textContent);
            ratingCount.textContent = currentCount + 1;
            
            // Show download prompt after delay
            setTimeout(() => {
                overlay.style.display = 'block';
                downloadPrompt.style.display = 'block';
                
                // Animate in
                setTimeout(() => {
                    overlay.style.opacity = '1';
                    downloadPrompt.style.transform = 'translate(-50%, -50%) scale(1)';
                }, 10);
            }, 1500);
        }
        
        function createRatingItem(username, rating, avatarUrl) {
            const item = document.createElement('div');
            item.className = 'rating-item';
            item.innerHTML = `
                <div class="rating-user-info">
                    <img class="rating-profile-pic" src="${avatarUrl}" alt="${username}">
                    <span class="rating-username">${username}</span>
                </div>
                <div class="rating-badge">
                    <span>${rating}</span>
                    <svg class="star" viewBox="0 0 24 24" fill="white">
                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                </div>
            `;
            return item;
        }
        
        function goBack() {
            // Simulate back navigation
            alert('Back navigation - in the app this would return to the previous screen');
        }
        
        function downloadApp() {
            // Simulate app download
            window.open('https://apps.apple.com', '_blank');
        }
        
        function dismissPrompt() {
            overlay.style.opacity = '0';
            downloadPrompt.style.transform = 'translate(-50%, -50%) scale(0.9)';
            
            setTimeout(() => {
                overlay.style.display = 'none';
                downloadPrompt.style.display = 'none';
            }, 300);
        }
        
        // Add CSS for animations
        const style = document.createElement('style');
        style.textContent = `
            .overlay {
                opacity: 0;
                transition: opacity 0.3s ease;
            }
            
            .download-prompt {
                transform: translate(-50%, -50%) scale(0.9);
                transition: transform 0.3s ease;
            }
        `;
        document.head.appendChild(style);
        
        // Prevent scrolling on mobile
        document.addEventListener('touchmove', function(e) {
            if (e.target.closest('.sheet-content')) return;
            e.preventDefault();
        }, { passive: false });
    </script>
</body>
</html>
