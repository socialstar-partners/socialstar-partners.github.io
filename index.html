<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Parlay Betting Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #10183C;
            color: white;
            overflow-x: hidden;
        }

        .container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            background: #1A2245;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .back-button {
            background: none;
            border: none;
            color: white;
            font-size: 27px;
            cursor: pointer;
        }

        .balance-section {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .balance-label {
            font-size: 15px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.7);
        }

        .coins-button {
            background: #2A3255;
            border: none;
            border-radius: 100px;
            padding: 8px 12px;
            display: flex;
            align-items: center;
            gap: 5px;
            color: white;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
        }

        .coins-button.insufficient {
            background: #F85149;
        }

        .coin-icon {
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #8B4513;
            font-weight: bold;
        }

        .plus-icon {
            font-size: 16px;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .parlay-container {
            background: #1A2245;
            border-radius: 14px;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
            width: 100%;
        }

        .section-title {
            font-size: 16px;
            font-weight: bold;
            color: white;
            margin-bottom: 16px;
        }

        /* Predictions Grid */
        .predictions-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .prediction-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 16px 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }

        .prediction-card.selected {
            background: rgba(65, 105, 225, 0.2);
            border-color: #4169E1;
        }

        .profile-picture {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin: 0 auto 12px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }

        .username {
            font-size: 16px;
            font-weight: 600;
            color: white;
            margin-bottom: 12px;
        }

        .stars {
            display: flex;
            justify-content: center;
            gap: 2px;
            margin-bottom: 8px;
        }

        .star {
            font-size: 15px;
            color: rgba(255, 255, 255, 0.3);
        }

        .star.filled {
            color: #FFD700;
        }

        .tap-text {
            font-size: 14px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.7);
        }

        /* Divider */
        .divider {
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
            margin: 20px 0;
        }

        /* Entry Section */
        .entry-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .entry-label {
            font-size: 15px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.7);
        }

        .entry-button {
            background: #4169E1;
            border: none;
            border-radius: 100px;
            padding: 8px 12px;
            display: flex;
            align-items: center;
            gap: 6px;
            color: white;
            cursor: pointer;
            font-weight: 600;
            font-size: 15px;
            transition: all 0.2s ease;
        }

        .entry-button.disabled {
            background: rgba(255, 255, 255, 0.15);
            color: rgba(255, 255, 255, 0.7);
        }

        .entry-button.no-amount {
            background: rgba(255, 255, 255, 0.15);
        }

        .entry-button.no-amount.has-predictions {
            background: #4169E1;
        }

        .pencil-icon {
            width: 15px;
            height: 15px;
            margin-right: 4px;
            color: white;
            font-size: 20px;
            transform: rotate(-45deg);
            display: inline-block;
        }

        /* Payout Section */
        .payout-section {
            space-y: 12px;
        }

        .payout-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .payout-label {
            font-size: 15px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.7);
        }

        .payout-value {
            font-size: 15px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.7);
        }

        .payout-value.large {
            font-size: 18px;
            font-weight: bold;
            color: white;
        }

        .profit-value {
            font-size: 16px;
            font-weight: bold;
            color: #00FF00;
        }

        /* Submit Button */
        .submit-button {
            background: #4169E1;
            border: none;
            border-radius: 100px;
            padding: 15px;
            width: 100%;
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.2s ease;
        }

        .submit-button:disabled {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.3);
            cursor: not-allowed;
        }

        /* Insufficient Coins Warning */
        .insufficient-coins {
            background: rgba(248, 81, 73, 0.1);
            border-radius: 8px;
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 16px;
        }

        .insufficient-text {
            font-size: 15px;
            font-weight: 600;
            color: #F85149;
        }

        .get-coins-button {
            background: #4169E1;
            border: none;
            border-radius: 100px;
            padding: 8px 16px;
            color: white;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
        }

        /* Modal Overlay */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: #1A2245;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            max-height: 90vh;
            overflow: hidden;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal-overlay.active .modal {
            transform: scale(1);
        }

        .modal-header {
            background: #2A3255;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 18px;
            font-weight: bold;
            color: white;
            margin-top: 3px;
        }

        .close-button {
            background: none;
            border: none;
            color: white;
            font-size: 28px;
            cursor: pointer;
        }

        /* Stake Editor */
        .amount-display {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            text-align: center;
            font-size: 36px;
            font-weight: bold;
            color: white;
            margin-bottom: 20px;
        }

        .quick-amounts {
            display: flex;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .quick-amount {
            flex: 1;
            background: rgba(255, 255, 255, 0.15);
            border: none;
            padding: 12px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .quick-amount:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .number-pad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            height: 240px;
        }

        .number-button {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 28px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .number-button:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .number-button:active {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Prediction Selector */
        .prediction-selector-content {
            padding: 20px;
        }

        .member-info {
            text-align: center;
            margin-bottom: 24px;
        }

        .member-info .profile-picture {
            width: 60px;
            height: 60px;
            margin-bottom: 12px;
        }

        .prediction-question {
            font-size: 18px;
            font-weight: 600;
            color: white;
            margin-bottom: 24px;
        }

        .rating-options {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .rating-option {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid transparent;
            border-radius: 8px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .rating-option .stars {
            display: flex;
            gap: 4px;
            align-items: center;
            margin-top: 7px;
        }

        .rating-option .star {
            font-size: 18px;
            color: rgba(255, 255, 255, 0.3);
            line-height: 1;
        }

        .rating-option .star.filled {
            color: #FFD700;
        }

        .rating-option:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .rating-option.selected {
            background: rgba(65, 105, 225, 0.2);
            border-color: #4169E1;
        }

        .rating-text {
            font-size: 16px;
            font-weight: 600;
            color: white;
        }

        /* Download App Screen */
        .download-screen {
            text-align: center;
            padding: 60px 30px;
            background: #1A2245;
            border-radius: 14px;
            margin: 20px;
            max-width: 500px;
            margin: 40px auto;
        }

        .download-title {
            font-size: 28px;
            font-weight: bold;
            color: white;
            margin-bottom: 20px;
        }

        .download-subtitle {
            font-size: 18px;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 40px;
            line-height: 1.4;
        }

        .download-button {
            background: linear-gradient(135deg, #4169E1, #6B73FF);
            border: none;
            border-radius: 12px;
            padding: 18px 40px;
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 20px;
            display: inline-block;
            text-decoration: none;
            box-shadow: 0 4px 15px rgba(65, 105, 225, 0.3);
            transition: all 0.3s ease;
        }

        .download-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(65, 105, 225, 0.4);
        }

        .reset-button {
            background: none;
            border: none;
            color: white;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .reset-button:hover {
            color: rgba(255, 255, 255, 0.8);
        }

        .hidden {
            display: none;
        }

        @media (max-width: 640px) {
            .modal {
                width: 95%;
                margin: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="mainView">
            <!-- Header -->
            <div class="header">
                <div style="width: 27px;"></div>
                <div class="balance-section">
                    <span class="balance-label">Balance</span>
                    <button class="coins-button" onclick="showGetCoins()">
                        <div class="coin-icon">C</div>
                        <span id="coinBalance">250</span>
                        <span class="plus-icon">+</span>
                    </button>
                </div>
            </div>

            <!-- Main Content -->
            <div class="main-content">
                <div class="parlay-container">
                    <!-- Predictions Section -->
                    <div>
                        <div class="section-title">Make Your Predictions</div>
                        <div class="predictions-grid" id="predictionsGrid">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>

                    <div class="divider"></div>

                    <!-- Entry Section -->
                    <div class="entry-section">
                        <span class="entry-label">Entry</span>
                        <button class="entry-button" id="entryButton" onclick="showStakeEditor()">
                            <div class="coin-icon">C</div>
                            <span id="entryAmount">Set Amount</span>
                        </button>
                    </div>

                    <div class="divider"></div>

                    <!-- Payout Section -->
                    <div class="payout-section">
                        <div class="payout-row">
                            <span class="payout-label">Multiplier</span>
                            <span class="payout-value" id="multiplierDisplay">0.0x</span>
                        </div>
                        <div class="payout-row">
                            <span class="payout-label">Est. Prize</span>
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <span class="payout-value large" id="prizeDisplay">0</span>
                                <div class="coin-icon">C</div>
                            </div>
                        </div>
                        <div class="payout-row" id="profitRow" style="display: none;">
                            <span class="payout-label">Profit</span>
                            <span class="profit-value" id="profitDisplay">+0</span>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <button class="submit-button" id="submitButton" onclick="placeBet()" disabled>
                        Make Predictions to Continue
                    </button>

                    <!-- Insufficient Coins Warning -->
                    <div class="insufficient-coins" id="insufficientCoins" style="display: none;">
                        <span class="insufficient-text" id="insufficientText">Need 0 more coins</span>
                        <button class="get-coins-button" onclick="showGetCoins()">Get Coins</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Download App Screen -->
        <div id="downloadScreen" class="hidden">
            <div class="download-screen">
                <div class="download-title">ðŸŽ‰ Nice Work!</div>
                <div class="download-subtitle">You just made your first parlay prediction! Ready to compete with your real friends and win actual prizes?</div>
                <a href="#" class="download-button">Get Started</a>
                <button class="reset-button" onclick="resetDemo()">Try Demo Again</button>
            </div>
        </div>
    </div>

    <!-- Stake Editor Modal -->
    <div class="modal-overlay" id="stakeModal">
        <div class="modal">
            <div class="modal-header">
                <button class="close-button" onclick="closeStakeEditor()">Ã—</button>
                <div class="modal-title">Set Entry Amount</div>
                <button class="close-button" onclick="saveStakeAmount()" id="saveStakeButton" style="opacity: 0.5;">âœ“</button>
            </div>
            <div class="amount-display" id="stakeAmountDisplay">0</div>
            <div class="quick-amounts">
                <button class="quick-amount" onclick="setQuickAmount(5)">
                    <div class="coin-icon">C</div>
                    <span>+5</span>
                </button>
                <button class="quick-amount" onclick="setQuickAmount(20)">
                    <div class="coin-icon">C</div>
                    <span>+20</span>
                </button>
                <button class="quick-amount" onclick="setQuickAmount(50)">
                    <div class="coin-icon">C</div>
                    <span>+50</span>
                </button>
            </div>
            <div class="number-pad">
                <button class="number-button" onclick="appendNumber('1')">1</button>
                <button class="number-button" onclick="appendNumber('2')">2</button>
                <button class="number-button" onclick="appendNumber('3')">3</button>
                <button class="number-button" onclick="appendNumber('4')">4</button>
                <button class="number-button" onclick="appendNumber('5')">5</button>
                <button class="number-button" onclick="appendNumber('6')">6</button>
                <button class="number-button" onclick="appendNumber('7')">7</button>
                <button class="number-button" onclick="appendNumber('8')">8</button>
                <button class="number-button" onclick="appendNumber('9')">9</button>
                <button class="number-button" onclick="clearAmount()">C</button>
                <button class="number-button" onclick="appendNumber('0')">0</button>
                <button class="number-button" onclick="deleteLastDigit()">âŒ«</button>
            </div>
        </div>
    </div>

    <!-- Prediction Selector Modal -->
    <div class="modal-overlay" id="predictionModal">
        <div class="modal">
            <div class="modal-header">
                <button class="close-button" onclick="closePredictionSelector()">Ã—</button>
                <div class="modal-title">Predict Rating</div>
                <div style="width: 30px;"></div>
            </div>
            <div class="prediction-selector-content">
                <div class="member-info">
                    <div class="profile-picture" id="selectedMemberAvatar"></div>
                    <div class="prediction-question" id="predictionQuestion">What will this person rate your photo?</div>
                </div>
                <div class="rating-options">
                    <div class="rating-option" onclick="selectRating(5)">
                        <div class="stars">
                            <span class="star filled">â˜…</span>
                            <span class="star filled">â˜…</span>
                            <span class="star filled">â˜…</span>
                            <span class="star filled">â˜…</span>
                            <span class="star filled">â˜…</span>
                        </div>
                        <span class="rating-text">5 Stars</span>
                    </div>
                    <div class="rating-option" onclick="selectRating(4)">
                        <div class="stars">
                            <span class="star filled">â˜…</span>
                            <span class="star filled">â˜…</span>
                            <span class="star filled">â˜…</span>
                            <span class="star filled">â˜…</span>
                            <span class="star">â˜…</span>
                        </div>
                        <span class="rating-text">4 Stars</span>
                    </div>
                    <div class="rating-option" onclick="selectRating(3)">
                        <div class="stars">
                            <span class="star filled">â˜…</span>
                            <span class="star filled">â˜…</span>
                            <span class="star filled">â˜…</span>
                            <span class="star">â˜…</span>
                            <span class="star">â˜…</span>
                        </div>
                        <span class="rating-text">3 Stars</span>
                    </div>
                    <div class="rating-option" onclick="selectRating(2)">
                        <div class="stars">
                            <span class="star filled">â˜…</span>
                            <span class="star filled">â˜…</span>
                            <span class="star">â˜…</span>
                            <span class="star">â˜…</span>
                            <span class="star">â˜…</span>
                        </div>
                        <span class="rating-text">2 Stars</span>
                    </div>
                    <div class="rating-option" onclick="selectRating(1)">
                        <div class="stars">
                            <span class="star filled">â˜…</span>
                            <span class="star">â˜…</span>
                            <span class="star">â˜…</span>
                            <span class="star">â˜…</span>
                            <span class="star">â˜…</span>
                        </div>
                        <span class="rating-text">1 Star</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let userCoins = 250;
        let customStakeAmount = '';
        let selectedPredictions = {};
        let selectedMemberId = '';
        
        // Demo friends data
        const friends = [
            { id: 'friend1', username: 'Sarah', avatar: 'S', color: '#667eea' },
            { id: 'friend2', username: 'Mike', avatar: 'M', color: '#764ba2' },
            { id: 'friend3', username: 'Emma', avatar: 'E', color: '#f093fb' },
            { id: 'friend4', username: 'Jake', avatar: 'J', color: '#f5576c' }
        ];

        // Competition Pricing Calculator
        class CompetitionPricingCalculator {
            getHouseEdge() {
                return 0.30;
            }
            
            getAssumedAccuracyRate() {
                return 0.50;
            }
            
            getParlayMultiplier(numberOfPredictions) {
                if (numberOfPredictions <= 0) return 1.0;
                
                const accuracyRate = this.getAssumedAccuracyRate();
                const winProbability = Math.pow(accuracyRate, numberOfPredictions);
                const fairMultiplier = 1.0 / winProbability;
                
                const houseEdge = this.getHouseEdge();
                const calculatedMultiplier = fairMultiplier * (1.0 - houseEdge);
                
                return Math.min(calculatedMultiplier, 100.0);
            }
            
            calculateParlayPayout(entryCost, predictions) {
                if (Object.keys(predictions).length === 0) return 0;
                
                const multiplier = this.getParlayMultiplier(Object.keys(predictions).length);
                const finalPayout = entryCost * multiplier;
                
                return Math.round(finalPayout);
            }
        }

        const calculator = new CompetitionPricingCalculator();

        // Initialize the app
        function init() {
            console.log('App starting...');
            renderPredictionCards();
            updateUI();
        }

        // Render prediction cards
        function renderPredictionCards() {
            const grid = document.getElementById('predictionsGrid');
            grid.innerHTML = '';
            
            friends.forEach(function(friend) {
                const isSelected = selectedPredictions[friend.id] !== undefined;
                const selectedRating = selectedPredictions[friend.id];
                
                const card = document.createElement('div');
                card.className = 'prediction-card' + (isSelected ? ' selected' : '');
                card.setAttribute('onclick', 'selectFriend("' + friend.id + '")');
                
                let starsHtml = '';
                if (selectedRating) {
                    for (let i = 1; i <= 5; i++) {
                        starsHtml += '<span class="star' + (i <= selectedRating ? ' filled' : '') + '">â˜…</span>';
                    }
                    starsHtml = '<div class="stars">' + starsHtml + '</div>';
                } else {
                    starsHtml = '<div class="tap-text">Tap to predict</div>';
                }
                
                card.innerHTML = 
                    '<div class="profile-picture" style="background: linear-gradient(135deg, ' + friend.color + ', #764ba2);">' +
                        friend.avatar +
                    '</div>' +
                    '<div class="username">' + friend.username + '</div>' +
                    starsHtml;
                
                grid.appendChild(card);
            });
        }

        // Select a friend for prediction
        function selectFriend(friendId) {
            if (selectedPredictions[friendId]) {
                delete selectedPredictions[friendId];
                updateUI();
                renderPredictionCards();
            } else {
                selectedMemberId = friendId;
                showPredictionSelector();
            }
        }

        // Show prediction selector modal
        function showPredictionSelector() {
            const friend = friends.find(function(f) { return f.id === selectedMemberId; });
            if (!friend) return;
            
            const modal = document.getElementById('predictionModal');
            const avatar = document.getElementById('selectedMemberAvatar');
            const question = document.getElementById('predictionQuestion');
            
            avatar.textContent = friend.avatar;
            avatar.style.background = 'linear-gradient(135deg, ' + friend.color + ', #764ba2)';
            question.textContent = 'What will ' + friend.username + ' rate your photo?';
            
            modal.classList.add('active');
        }

        // Close prediction selector
        function closePredictionSelector() {
            document.getElementById('predictionModal').classList.remove('active');
        }

        // Select a rating
        function selectRating(rating) {
            selectedPredictions[selectedMemberId] = rating;
            setTimeout(function() {
                closePredictionSelector();
                updateUI();
                renderPredictionCards();
            }, 200);
        }

        // Show stake editor
        function showStakeEditor() {
            const modal = document.getElementById('stakeModal');
            const display = document.getElementById('stakeAmountDisplay');
            display.textContent = customStakeAmount || '0';
            modal.classList.add('active');
            updateSaveButton();
        }

        // Close stake editor
        function closeStakeEditor() {
            document.getElementById('stakeModal').classList.remove('active');
            updateUI(); // Update UI with current amount when closing
        }

        // Save stake amount
        function saveStakeAmount() {
            if (parseInt(customStakeAmount) > 0) {
                closeStakeEditor();
                updateUI();
            }
        }

        // Set quick amount
        function setQuickAmount(amount) {
            customStakeAmount = amount.toString();
            document.getElementById('stakeAmountDisplay').textContent = customStakeAmount;
            updateSaveButton();
        }

        // Number pad functions
        function appendNumber(digit) {
            if (customStakeAmount === '0') {
                customStakeAmount = digit;
            } else if (customStakeAmount.length < 8) {
                customStakeAmount += digit;
            }
            document.getElementById('stakeAmountDisplay').textContent = customStakeAmount;
            updateSaveButton();
        }

        function deleteLastDigit() {
            if (customStakeAmount.length > 0) {
                customStakeAmount = customStakeAmount.slice(0, -1);
                document.getElementById('stakeAmountDisplay').textContent = customStakeAmount || '0';
                updateSaveButton();
            }
        }

        function clearAmount() {
            customStakeAmount = '';
            document.getElementById('stakeAmountDisplay').textContent = '0';
            updateSaveButton();
        }

        // Update save button state
        function updateSaveButton() {
            const saveButton = document.getElementById('saveStakeButton');
            const amount = parseInt(customStakeAmount);
            saveButton.style.opacity = amount > 0 ? '1.0' : '0.5';
        }

        // Get computed values
        function getEntryCost() {
            const amount = parseInt(customStakeAmount);
            return amount > 0 ? amount : 0;
        }

        function getEstimatedPayout() {
            const entryCost = getEntryCost();
            if (Object.keys(selectedPredictions).length === 0 || entryCost === 0) return 0;
            return calculator.calculateParlayPayout(entryCost, selectedPredictions);
        }

        function getParlayMultiplier() {
            if (Object.keys(selectedPredictions).length === 0) return 0;
            return calculator.getParlayMultiplier(Object.keys(selectedPredictions).length);
        }

        // Update UI elements
        function updateUI() {
            const entryCost = getEntryCost();
            const estimatedPayout = getEstimatedPayout();
            const multiplier = getParlayMultiplier();
            const predictionsCount = Object.keys(selectedPredictions).length;
            const profit = estimatedPayout - entryCost;

            // Update coin balance
            document.getElementById('coinBalance').textContent = userCoins;
            
            // Update balance button background based on insufficient funds
            const coinsButton = document.querySelector('.coins-button');
            if (entryCost > 0 && userCoins < entryCost) {
                coinsButton.classList.add('insufficient');
            } else {
                coinsButton.classList.remove('insufficient');
            }

            // Update entry button
            const entryButton = document.getElementById('entryButton');
            const entryAmount = document.getElementById('entryAmount');
            
            if (entryCost > 0) {
                entryAmount.textContent = entryCost.toString();
                entryButton.className = 'entry-button';
            } else {
                entryAmount.textContent = 'Set Amount';
                if (predictionsCount > 0) {
                    entryButton.className = 'entry-button no-amount has-predictions';
                } else {
                    entryButton.className = 'entry-button no-amount';
                }
            }

            // Update multiplier
            document.getElementById('multiplierDisplay').textContent = multiplier.toFixed(1) + 'x';

            // Update estimated prize
            document.getElementById('prizeDisplay').textContent = estimatedPayout.toString();

            // Update profit
            const profitRow = document.getElementById('profitRow');
            const profitDisplay = document.getElementById('profitDisplay');
            if (profit > 0) {
                profitRow.style.display = 'flex';
                profitDisplay.textContent = '+' + profit;
            } else {
                profitRow.style.display = 'none';
            }

            // Update submit button
            const submitButton = document.getElementById('submitButton');
            const canSubmit = userCoins >= entryCost && predictionsCount > 0 && entryCost > 0;
            
            let buttonText;
            if (predictionsCount === 0) {
                buttonText = 'Make Predictions to Continue';
            } else if (entryCost === 0) {
                buttonText = 'Set Entry Amount';
            } else {
                buttonText = 'Place Prediction';
            }
            
            submitButton.textContent = buttonText;
            submitButton.disabled = !canSubmit;

            // Update insufficient coins warning
            const insufficientCoins = document.getElementById('insufficientCoins');
            const insufficientText = document.getElementById('insufficientText');
            
            if (entryCost > 0 && userCoins < entryCost) {
                const needed = entryCost - userCoins;
                insufficientText.textContent = 'Need ' + needed + ' more coins';
                insufficientCoins.style.display = 'flex';
            } else {
                insufficientCoins.style.display = 'none';
            }
        }

        // Place bet and show download screen
        function placeBet() {
            const entryCost = getEntryCost();
            const predictionsCount = Object.keys(selectedPredictions).length;
            
            if (userCoins >= entryCost && predictionsCount > 0 && entryCost > 0) {
                userCoins -= entryCost;
                
                document.getElementById('mainView').classList.add('hidden');
                document.getElementById('downloadScreen').classList.remove('hidden');
            }
        }

        // Show get coins message
        function showGetCoins() {
            alert('In the real app, you can purchase coins here! This is just a demo.');
        }

        // Reset demo
        function resetDemo() {
            userCoins = 250;
            customStakeAmount = '';
            selectedPredictions = {};
            selectedMemberId = '';
            
            document.getElementById('mainView').classList.remove('hidden');
            document.getElementById('downloadScreen').classList.add('hidden');
            
            renderPredictionCards();
            updateUI();
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', init);

        // Add modal click handlers
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('stakeModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeStakeEditor();
                }
            });

            document.getElementById('predictionModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closePredictionSelector();
                }
            });
        });
    </script>
